/*! For license information please see qliro-one-for-woocommerce.min.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return o};var r,o={},n=Object.prototype,i=n.hasOwnProperty,l=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",d=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(r){u=function(e,t,r){return e[t]=r}}function p(e,t,r,o){var n=t&&t.prototype instanceof _?t:_,i=Object.create(n.prototype),a=new N(o||[]);return l(i,"_invoke",{value:P(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=p;var f="suspendedStart",m="suspendedYield",g="executing",v="completed",y={};function _(){}function b(){}function w(){}var O={};u(O,s,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(F([])));S&&S!==n&&i.call(S,s)&&(O=S);var C=w.prototype=_.prototype=Object.create(O);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function A(t,r){function o(n,l,a,s){var c=h(t[n],t,l);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==e(u)&&i.call(u,"__await")?r.resolve(u.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):r.resolve(u).then((function(e){d.value=e,a(d)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var n;l(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,n){o(e,t,r,n)}))}return n=n?n.then(i,i):i()}})}function P(e,t,o){var n=f;return function(i,l){if(n===g)throw new Error("Generator is already running");if(n===v){if("throw"===i)throw l;return{value:r,done:!0}}for(o.method=i,o.arg=l;;){var a=o.delegate;if(a){var s=q(a,o);if(s){if(s===y)continue;return s}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(n===f)throw n=v,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);n=g;var c=h(e,t,o);if("normal"===c.type){if(n=o.done?v:m,c.arg===y)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(n=v,o.method="throw",o.arg=c.arg)}}}function q(e,t){var o=t.method,n=e.iterator[o];if(n===r)return t.delegate=null,"throw"===o&&e.iterator.return&&(t.method="return",t.arg=r,q(e,t),"throw"===t.method)||"return"!==o&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+o+"' method")),y;var i=h(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,y;var l=i.arg;return l?l.done?(t[e.resultName]=l.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,y):l:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function F(t){if(t||""===t){var o=t[s];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,l=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return l.next=l}}throw new TypeError(e(t)+" is not iterable")}return b.prototype=w,l(C,"constructor",{value:w,configurable:!0}),l(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,d,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,d,"GeneratorFunction")),e.prototype=Object.create(C),e},o.awrap=function(e){return{__await:e}},x(A.prototype),u(A.prototype,c,(function(){return this})),o.AsyncIterator=A,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var l=new A(p(e,t,r,n),i);return o.isGeneratorFunction(t)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},x(C),u(C,d,"Generator"),u(C,s,(function(){return this})),u(C,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),r=[];for(var o in t)r.push(o);return r.reverse(),function e(){for(;r.length;){var o=r.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},o.values=F,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(o,n){return a.type="throw",a.arg=e,t.next=o,n&&(t.method="next",t.arg=r),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var l=this.tryEntries[n],a=l.completion;if("root"===l.tryLoc)return o("end");if(l.tryLoc<=this.prev){var s=i.call(l,"catchLoc"),c=i.call(l,"finallyLoc");if(s&&c){if(this.prev<l.catchLoc)return o(l.catchLoc,!0);if(this.prev<l.finallyLoc)return o(l.finallyLoc)}else if(s){if(this.prev<l.catchLoc)return o(l.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return o(l.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var n=o;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var l=n?n.completion:{};return l.type=e,l.arg=t,n?(this.method="next",this.next=n.finallyLoc,y):this.complete(l)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var o=r.completion;if("throw"===o.type){var n=o.arg;E(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,o){return this.delegate={iterator:F(e),resultName:t,nextLoc:o},"next"===this.method&&(this.arg=r),y}},o}function r(e,t,r,o,n,i,l){try{var a=e[i](l),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(o,n)}jQuery((function(e){if("undefined"==typeof qliroOneParams||"yes"!==qliroOneParams.isEnabled)return!1;var o,n,i={bodyEl:e("body"),checkoutFormSelector:"form.checkout",preventPaymentMethodChange:!1,selectAnotherSelector:"#qliro-one-select-other",paymentMethodEl:e('input[name="payment_method"]'),init:function(){e(document).ready(i.documentReady),i.bodyEl.on("change",'input[name="payment_method"]',i.maybeChangeToQliroOne),i.bodyEl.on("click",i.selectAnotherSelector,i.changeFromQliroOne),i.bodyEl.on("updated_checkout",i.maybeDisplayShippingPrice),i.renderIframe()},documentReady:function(){0<e('input[name="payment_method"]').length?i.paymentMethod=e('input[name="payment_method"]').filter(":checked").val():i.paymentMethod="qliro_one",qliroOneParams.payForOrder||"qliro_one"!==i.paymentMethod||i.moveExtraCheckoutFields(),i.bodyEl.on("update_checkout",i.updateCheckout),i.bodyEl.on("updated_checkout",i.updatedCheckout),e("#billing_country").on("change",(function(){return e("body").trigger("update_checkout")}))},renderIframe:function(){window.q1Ready=function(e){e.onCustomerInfoChanged(i.updateAddress),e.onValidateOrder(i.placeWooOrder),e.onShippingMethodChanged(i.shippingMethodChanged)},e("#qliro-one-iframe").append(qliroOneParams.iframeSnippet)},updateCheckout:function(){void 0!==window.q1&&window.q1.lock()},updatedCheckout:function(){void 0!==window.q1&&window.q1.onOrderUpdated((function(e){window.q1.unlock()}))},shippingMethodChanged:function(t){e("#qoc_shipping_data").val(JSON.stringify(t)),e("body").trigger("qoc_shipping_option_changed",[t]),e("body").trigger("update_checkout")},changeFromQliroOne:function(t){t.preventDefault(),e(i.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",data:{qliro_one:!1,nonce:qliroOneParams.change_payment_method_nonce},url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToQliroOne:function(){i.preventPaymentMethodChange||"qliro_one"===e(this).val()&&(e(".woocommerce-info").remove(),e(i.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",data:{qliro_one:!0,nonce:qliroOneParams.change_payment_method_nonce},dataType:"json",url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},maybeDisplayShippingPrice:function(){if(!e(".qoc-shipping").length&&"qliro_one"===i.paymentMethod&&"no"!==qliroOneParams.shipping_in_iframe)if(e("#shipping_method input[type='radio']").length)e("#shipping_method input[type='radio']:checked").each((function(){var t=e(this).attr("id"),r=e("label[for='"+t+"']").text();e(".woocommerce-shipping-totals td").html(r),e(".woocommerce-shipping-totals td").addClass("qoc-shipping")}));else{var t=e("#shipping_method input[name='shipping_method[0]']").attr("id"),r=e("label[for='"+t+"']").text();e(".woocommerce-shipping-totals td").html(r),e(".woocommerce-shipping-totals td").addClass("qoc-shipping")}},checkIfQliroOneSelected:function(){return i.paymentMethodEl.length>0&&(i.paymentMethod=i.paymentMethodEl.filter(":checked").val(),"qliro_one"===i.paymentMethod)},moveExtraCheckoutFields:function(){e(".woocommerce-additional-fields").appendTo("#qliro-one-extra-checkout-fields");for(var t=e('form[name="checkout"] input, form[name="checkout"] select, textarea'),r=0;r<t.length;r++){var o=t[r].name;e("table.woocommerce-checkout-review-order-table").find(t[r]).length||-1===e.inArray(o,qliroOneParams.standardWooCheckoutFields)&&(0<e("p#"+o+"_field").length?e("p#"+o+"_field").appendTo("#qliro-one-extra-checkout-fields"):e('input[name="'+o+'"]').closest("p").appendTo("#qliro-one-extra-checkout-fields"))}},updateAddress:(o=t().mark((function r(o){var n,l,a,s,c,d,u,p,h,f,m,g,v,y,_,b,w,O,k,S,C,x,A,P,q,T,E,N,F,L,j,M,Q,J,G,I,D,R,W,z,V,X,Y,U,$,B,H,K,Z,ee,te,re,oe,ne,ie,le,ae,se,ce;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.ajax({type:"POST",data:{nonce:qliroOneParams.get_order_nonce},dataType:"json",url:qliroOneParams.get_order_url});case 3:if((T=t.sent).success){t.next=6;break}throw"Failed to GET address";case 6:E=T.data,A=E.billingAddress,P=E.shippingAddress,q=E.customer,t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.warning(t.t0),window.location.reload();case 16:N=null!==(n=null===(l=A)||void 0===l?void 0:l.FirstName)&&void 0!==n?n:null==o||null===(a=o.address)||void 0===a?void 0:a.firstName,F=null!==(s=null===(c=A)||void 0===c?void 0:c.LastName)&&void 0!==s?s:null==o||null===(d=o.address)||void 0===d?void 0:d.lastName,L=null!==(u=null===(p=A)||void 0===p?void 0:p.Street)&&void 0!==u?u:null==o||null===(h=o.address)||void 0===h?void 0:h.street,j=null!==(f=null===(m=A)||void 0===m?void 0:m.PostalCode)&&void 0!==f?f:null==o||null===(g=o.address)||void 0===g?void 0:g.postalCode,M=null!==(v=null===(y=A)||void 0===y?void 0:y.City)&&void 0!==v?v:null==o||null===(_=o.address)||void 0===_?void 0:_.city,Q=null!==(b=null===(w=A)||void 0===w?void 0:w.Area)&&void 0!==b?b:null==o||null===(O=o.address)||void 0===O?void 0:O.area,J=null!==(k=null===(S=q)||void 0===S?void 0:S.MobileNumber)&&void 0!==k?k:null==o?void 0:o.mobileNumber,G=null!==(C=null===(x=q)||void 0===x?void 0:x.Email)&&void 0!==C?C:null==o?void 0:o.email,i.setCustomerType(o),e("#ship-to-different-address-checkbox").is(":checked")?(ne=null!==(I=null===(D=P)||void 0===D?void 0:D.FirstName)&&void 0!==I?I:null==o||null===(R=o.address)||void 0===R?void 0:R.firstName,ie=null!==(W=null===(z=P)||void 0===z?void 0:z.LastName)&&void 0!==W?W:null==o||null===(V=o.address)||void 0===V?void 0:V.lastName,le=null!==(X=null===(Y=P)||void 0===Y?void 0:Y.Street)&&void 0!==X?X:null==o||null===(U=o.address)||void 0===U?void 0:U.street,ae=null!==($=null===(B=P)||void 0===B?void 0:B.PostalCode)&&void 0!==$?$:null==o||null===(H=o.address)||void 0===H?void 0:H.postalCode,se=null!==(K=null===(Z=P)||void 0===Z?void 0:Z.City)&&void 0!==K?K:null==o||null===(ee=o.address)||void 0===ee?void 0:ee.city,ce=null!==(te=null===(re=P)||void 0===re?void 0:re.Area)&&void 0!==te?te:null==o||null===(oe=o.address)||void 0===oe?void 0:oe.area,null!=G&&e("#shipping_email").val(G),null!=J&&e("#shipping_phone").val(J),null!=ne&&e("#shipping_first_name").val(ne),null!=ie&&e("#shipping_last_name").val(ie),null!=le&&e("#shipping_address_1").val(le),null!=ae&&e("#shipping_postcode").val(ae),null!=se&&e("#shipping_city").val(se),null!=ce&&i.setStateField("shipping",ce),e("body").trigger("update_checkout"),e("#shipping_email").change(),e("#shipping_email").blur()):(null!=G&&e("#billing_email").val(G),null!=J&&e("#billing_phone").val(J),null!=N&&e("#billing_first_name").val(N),null!=F&&e("#billing_last_name").val(F),null!=L&&e("#billing_address_1").val(L),null!=j&&e("#billing_postcode").val(j),null!=M&&e("#billing_city").val(M),null!=Q&&i.setStateField("billing",Q),e("form.checkout").trigger("update_checkout"),e("#billing_email").change(),e("#billing_email").blur());case 26:case"end":return t.stop()}}),r,null,[[0,12]])})),n=function(){var e=this,t=arguments;return new Promise((function(n,i){var l=o.apply(e,t);function a(e){r(l,n,i,a,s,"next",e)}function s(e){r(l,n,i,a,s,"throw",e)}a(void 0)}))},function(e){return n.apply(this,arguments)}),setCustomerType:function(e){e.organizationNumber?Cookies.set(qliroOneParams.customerTypeCookieName,"business"):Cookies.set(qliroOneParams.customerTypeCookieName,"consumer")},getQliroOneOrder:function(t,r){i.logToFile("onValidateOrder from Qliro triggered"),e.ajax({type:"POST",data:{nonce:qliroOneParams.get_order_nonce},dataType:"json",url:qliroOneParams.get_order_url,success:function(e){},error:function(e){},complete:function(e){if(!0!==e.responseJSON.success)return i.failOrder("getQliroOneOrder",e.responseJSON.data,r),void(e.responseJSON.data.redirect&&(window.location.href=e.responseJSON.data.redirect));i.setAddressData(e.responseJSON.data,r),console.log("getQliroOneOrder completed")}})},setAddressData:function(t,r){0<e("form.checkout #terms").length&&e("form.checkout #terms").prop("checked",!0),console.log(t),e("#billing_first_name").val(t.billingAddress.FirstName),e("#billing_last_name").val(t.billingAddress.LastName),e("#billing_company").val(t.billingAddress.CompanyName),e("#billing_address_1").val(t.billingAddress.Street),e("#billing_address_2").val(t.billingAddress.CareOf?t.billingAddress.CareOf+(t.billingAddress.Street2?" "+t.billingAddress.Street2:""):t.billingAddress.Street2),e("#billing_city").val(t.billingAddress.City),e("#billing_postcode").val(t.billingAddress.PostalCode),i.setStateField("billing",t.billingAddress.Area),e("#billing_phone").val(t.customer.MobileNumber),e("#billing_email").val(t.customer.Email),e("#ship-to-different-address-checkbox").prop("checked",!0),e("#shipping_first_name").val(t.shippingAddress.FirstName),e("#shipping_last_name").val(t.shippingAddress.LastName),e("#shipping_company").val(t.shippingAddress.CompanyName),e("#shipping_address_1").val(t.shippingAddress.Street),e("#shipping_address_2").val(t.shippingAddress.CareOf?t.shippingAddress.CareOf+(t.shippingAddress.Street2?" "+t.shippingAddress.Street2:""):t.shippingAddress.Street2),e("#shipping_city").val(t.shippingAddress.City),e("#shipping_postcode").val(t.shippingAddress.PostalCode),i.setStateField("shipping",t.shippingAddress.Area),t.billingAddress&&e("#billing_country").val(t.billingAddress.CountryCode),t.shippingAddress&&e("#shipping_country").val(t.shippingAddress.CountryCode),i.submitOrder(r)},setStateField:function(t,r){if(null!=r){var o=e("#".concat(t,"_state"));0!==o.length&&(o.is("select")?o.find("option").each((function(){e(this).text()===r&&o.val(e(this).val())})):o.val(r))}},submitOrder:function(t){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:qliroOneParams.submitOrder,data:e("form.checkout").serialize()+"&"+e("#billing_country").serialize(),dataType:"json",success:function(e){console.log(e);try{if("success"!==e.result)throw console.log("submit order - missing success",e),"Result failed";console.log("submit order success",e),i.logToFile('Successfully placed order. Sending "shouldProceed: true" to Qliro.'),t({shouldProceed:!0,errorMessage:""}),clearTimeout(i.timeout)}catch(o){if(console.log("catch error"),console.error(o),e.messages){var r=e.messages.replace(/<\/?[^>]+(>|$)/g,"");console.log("error ",r),i.logToFile("Checkout error | "+r),i.failOrder("submission",r,t)}else i.logToFile("Checkout error | No message"),i.failOrder("submission","Checkout error",t)}},error:function(e){try{i.logToFile("AJAX error | "+JSON.stringify(e))}catch(e){i.logToFile("AJAX error | Failed to parse error message.")}i.failOrder("ajax-error","Internal Server Error",t)}})},failOrder:function(t,r,o){clearTimeout(i.timeout),o({shouldProceed:!1,errorMessage:r}),e(i.checkoutFormSelector).removeClass("processing"),e(i.checkoutFormSelector).unblock(),e(".woocommerce-checkout-review-order-table").unblock(),e("body").trigger("update_checkout")},placeWooOrder:function(e,t){i.timeout=setTimeout((function(){i.logToFile("Timeout error | Timeout when placing the WooCommerce order"),i.failOrder("timeout-error","Timeout error",t)}),29e3),i.getQliroOneOrder(e,t)},logToFile:function(t){e.ajax({url:qliroOneParams.log_to_file_url,type:"POST",dataType:"json",data:{message:t,nonce:qliroOneParams.log_to_file_nonce}})}};i.init()}))})();
//# sourceMappingURL=qliro-one-for-woocommerce.min.js.map