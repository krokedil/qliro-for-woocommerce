jQuery((function(e){if("undefined"==typeof qliroOneParams||"yes"!==qliroOneParams.isEnabled)return!1;var n={bodyEl:e("body"),checkoutFormSelector:"form.checkout",preventPaymentMethodChange:!1,selectAnotherSelector:"#qliro-one-select-other",paymentMethodEl:e('input[name="payment_method"]'),init:function(){e(document).ready(n.documentReady),n.bodyEl.on("change",'input[name="payment_method"]',n.maybeChangeToQliroOne),n.bodyEl.on("click",n.selectAnotherSelector,n.changeFromQliroOne),window.q1Ready=function(e){e.onCustomerInfoChanged(n.updateAddress)}},documentReady:function(){0<e('input[name="payment_method"]').length?n.paymentMethod=e('input[name="payment_method"]').filter(":checked").val():n.paymentMethod="qliro_one",qliroOneParams.payForOrder||"qliro_one"!==n.paymentMethod||n.moveExtraCheckoutFields()},changeFromQliroOne:function(o){o.preventDefault(),e(n.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",data:{qliro_one:!1,nonce:qliroOneParams.change_payment_method_nonce},url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToQliroOne:function(){n.preventPaymentMethodChange||"qliro_one"===e(this).val()&&(e(".woocommerce-info").remove(),e(n.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",data:{qliro_one:!0,nonce:qliroOneParams.change_payment_method_nonce},dataType:"json",url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},checkIfQliroOneSelected:function(){return n.paymentMethodEl.length>0&&(n.paymentMethod=n.paymentMethodEl.filter(":checked").val(),"qliro_one"===n.paymentMethod)},moveExtraCheckoutFields:function(){e(".woocommerce-additional-fields").appendTo("#qliro-one-extra-checkout-fields");for(var n=e('form[name="checkout"] input, form[name="checkout"] select, textarea'),o=0;o<n.length;o++){var l=n[o].name;console.log("wc input element ",l),e("table.woocommerce-checkout-review-order-table").find(n[o]).length||-1===e.inArray(l,qliroOneParams.standardWooCheckoutFields)&&(0<e("p#"+l+"_field").length?e("p#"+l+"_field").appendTo("#qliro-one-extra-checkout-fields"):e('input[name="'+l+'"]').closest("p").appendTo("#qliro-one-extra-checkout-fields"))}},updateAddress:function(n){var o="email"in n?n.email:null,l="mobileNumber"in n?n.mobileNumber:null,a="firstName"in n.address?n.address.firstName:null,t="lastName"in n.address?n.address.lastName:null,r="street"in n.address?n.address.street:null,i="postalCode"in n.address?n.address.postalCode:null,s="city"in n.address?n.address.city:null;null!=o&&e("#billing_email").val(n.email),null!=l&&e("#billing_phone").val(n.mobileNumber),null!=a&&e("#billing_first_name").val(n.address.firstName),null!=t&&e("#billing_last_name").val(n.address.lastName),null!=r&&e("#billing_address_1").val(n.address.street),null!=i&&e("#billing_postcode").val(n.address.postalCode),null!=s&&e("#billing_city").val(n.address.city),e("form.checkout").trigger("update_checkout")},getQliroOneOrder:function(){e.ajax({type:"POST",data:{nonce:qliroOneParams.get_order_nonce},dataType:"json",url:qliroOneParams.get_order_url,success:function(e){},error:function(e){},complete:function(e){n.setAddressData(e.responseJSON.data)}})},setAddressData:function(o){0<e("form.checkout #terms").length&&e("form.checkout #terms").prop("checked",!0),console.log(o),e("#billing_first_name").val(o.billingAddress.FirstName),e("#billing_last_name").val(o.billingAddress.LastName),e("#billing_company").val(o.billingAddress.CompanyName),e("#billing_address_1").val(o.billingAddress.Street),e("#billing_address_2").val(o.billingAddress.Street2),e("#billing_city").val(o.billingAddress.City),e("#billing_postcode").val(o.billingAddress.PostalCode),e("#billing_phone").val(o.customer.MobileNumber),e("#billing_email").val(o.customer.Email),e("#ship-to-different-address-checkbox").prop("checked",!0),e("#shipping_first_name").val(o.shippingAddress.FirstName),e("#shipping_last_name").val(o.shippingAddress.LastName),e("#shipping_company").val(o.shippingAddress.CompanyName),e("#shipping_address_1").val(o.shippingAddress.Street),e("#shipping_address_2").val(o.shippingAddress.Street2),e("#shipping_city").val(o.shippingAddress.City),e("#shipping_postcode").val(o.shippingAddress.PostalCode),o.billingAddress&&e("#billing_country").val(o.billingAddress.CountryCode),o.shippingAddress&&e("#shipping_country").val(o.shippingAddress.CountryCode),n.submitOrder()},submitOrder:function(){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:qliroOneParams.submitOrder,data:e("form.checkout").serialize(),dataType:"json",success:function(e){try{if("success"!==e.result)throw console.log(e,1111),"Result failed";console.log("submit order success",e)}catch(n){console.log("catch error"),console.error(n),e.messages?console.log("error ",e.messages):console.log("no message")}},error:function(e){console.log(e)}})}};n.init()}));
//# sourceMappingURL=qliro-one-for-woocommerce.min.js.map