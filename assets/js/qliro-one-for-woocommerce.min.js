/*! For license information please see qliro-one-for-woocommerce.min.js.LICENSE.txt */
(()=>{function e(){var n,i,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",l=r.toStringTag||"@@toStringTag";function a(e,r,t,l){var a=r&&r.prototype instanceof d?r:d,c=Object.create(a.prototype);return o(c,"_invoke",function(e,o,r){var t,l,a,d=0,c=r||[],u=!1,p={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,o){return t=e,l=0,a=n,p.n=o,s}};function m(e,o){for(l=e,a=o,i=0;!u&&d&&!r&&i<c.length;i++){var r,t=c[i],m=p.p,h=t[2];e>3?(r=h===o)&&(a=t[(l=t[4])?5:(l=3,3)],t[4]=t[5]=n):t[0]<=m&&((r=e<2&&m<t[1])?(l=0,p.v=o,p.n=t[1]):m<h&&(r=e<3||t[0]>o||o>h)&&(t[4]=e,t[5]=o,p.n=h,l=0))}if(r||e>1)return s;throw u=!0,o}return function(r,c,h){if(d>1)throw TypeError("Generator is already running");for(u&&1===c&&m(c,h),l=c,a=h;(i=l<2?n:a)||!u;){t||(l?l<3?(l>1&&(p.n=-1),m(l,a)):p.n=a:p.v=a);try{if(d=2,t){if(l||(r="next"),i=t[r]){if(!(i=i.call(t,a)))throw TypeError("iterator result is not an object");if(!i.done)return i;a=i.value,l<2&&(l=0)}else 1===l&&(i=t.return)&&i.call(t),l<2&&(a=TypeError("The iterator does not provide a '"+r+"' method"),l=1);t=n}else if((i=(u=p.n<0)?a:e.call(o,p))!==s)break}catch(e){t=n,l=1,a=e}finally{d=1}}return{value:i,done:u}}}(e,t,l),!0),c}var s={};function d(){}function c(){}function u(){}i=Object.getPrototypeOf;var p=[][t]?i(i([][t]())):(o(i={},t,function(){return this}),i),m=u.prototype=d.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,o(e,l,"GeneratorFunction")),e.prototype=Object.create(m),e}return c.prototype=u,o(m,"constructor",u),o(u,"constructor",c),c.displayName="GeneratorFunction",o(u,l,"GeneratorFunction"),o(m),o(m,l,"Generator"),o(m,t,function(){return this}),o(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:a,m:h}})()}function o(e,n,i,r){var t=Object.defineProperty;try{t({},"",{})}catch(e){t=0}o=function(e,n,i,r){function l(n,i){o(e,n,function(e){return this._invoke(n,i,e)})}n?t?t(e,n,{value:i,enumerable:!r,configurable:!r,writable:!r}):e[n]=i:(l("next",0),l("throw",1),l("return",2))},o(e,n,i,r)}function n(e,o,n,i,r,t,l){try{var a=e[t](l),s=a.value}catch(e){return void n(e)}a.done?o(s):Promise.resolve(s).then(i,r)}jQuery(function(o){if("undefined"==typeof qliroOneParams||"yes"!==qliroOneParams.isEnabled)return!1;var i,r,t={bodyEl:o("body"),checkoutFormSelector:"form.checkout",preventPaymentMethodChange:!1,selectAnotherSelector:"#qliro-one-select-other",paymentMethodEl:o('input[name="payment_method"]'),init:function(){o(document).ready(t.documentReady),t.bodyEl.on("change",'input[name="payment_method"]',t.maybeChangeToQliroOne),t.bodyEl.on("click",t.selectAnotherSelector,t.changeFromQliroOne),t.bodyEl.on("updated_checkout",t.maybeDisplayShippingPrice),t.renderIframe(),o("#qliro_billing_country").on("change",function(){var e=o("#qliro_billing_country").val();o("#billing_country, #shipping_country").val(e),o("body").trigger("update_checkout")})},documentReady:function(){0<o('input[name="payment_method"]').length?t.paymentMethod=o('input[name="payment_method"]').filter(":checked").val():t.paymentMethod="qliro_one",qliroOneParams.payForOrder||"qliro_one"!==t.paymentMethod||t.moveExtraCheckoutFields(),t.bodyEl.on("update_checkout",t.updateCheckout),t.bodyEl.on("updated_checkout",t.updatedCheckout),o("#billing_country").on("change",function(){return o("body").trigger("update_checkout")})},renderIframe:function(){window.q1Ready=function(e){e.onCustomerInfoChanged(t.updateAddress),e.onValidateOrder(t.placeWooOrder),e.onShippingMethodChanged(t.shippingMethodChanged)},o("#qliro-one-iframe").append(qliroOneParams.iframeSnippet)},updateCheckout:function(){void 0!==window.q1&&window.q1.lock()},updatedCheckout:function(){void 0!==window.q1&&window.q1.onOrderUpdated(function(e){window.q1.unlock()})},shippingMethodChanged:function(e){o("#qoc_shipping_data").val(JSON.stringify(e)),o("body").trigger("qoc_shipping_option_changed",[e]),o("body").trigger("update_checkout")},changeFromQliroOne:function(e){e.preventDefault(),o(t.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.ajax({type:"POST",dataType:"json",data:{qliro_one:!1,nonce:qliroOneParams.change_payment_method_nonce},url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToQliroOne:function(){t.preventPaymentMethodChange||"qliro_one"===o(this).val()&&(o(".woocommerce-info").remove(),o(t.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.ajax({type:"POST",data:{qliro_one:!0,nonce:qliroOneParams.change_payment_method_nonce},dataType:"json",url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},maybeDisplayShippingPrice:function(){if(!o(".qoc-shipping").length&&"qliro_one"===t.paymentMethod&&"no"!==qliroOneParams.shipping_in_iframe)if(o("#shipping_method input[type='radio']").length)o("#shipping_method input[type='radio']:checked").each(function(){var e=o(this).attr("id"),n=o("label[for='"+e+"']").text();o(".woocommerce-shipping-totals td").html(n),o(".woocommerce-shipping-totals td").addClass("qoc-shipping")});else{var e=o("#shipping_method input[name='shipping_method[0]']").attr("id"),n=o("label[for='"+e+"']").text();o(".woocommerce-shipping-totals td").html(n),o(".woocommerce-shipping-totals td").addClass("qoc-shipping")}},checkIfQliroOneSelected:function(){return t.paymentMethodEl.length>0&&(t.paymentMethod=t.paymentMethodEl.filter(":checked").val(),"qliro_one"===t.paymentMethod)},moveExtraCheckoutFields:function(){o(".woocommerce-additional-fields").appendTo("#qliro-one-extra-checkout-fields");for(var e=o('form[name="checkout"] input, form[name="checkout"] select, textarea'),n=0;n<e.length;n++){var i=e[n].name;"qliro_billing_country"!==i&&(o("table.woocommerce-checkout-review-order-table").find(e[n]).length||-1===o.inArray(i,qliroOneParams.standardWooCheckoutFields)&&(0<o("p#"+i+"_field").length?o("p#"+i+"_field").appendTo("#qliro-one-extra-checkout-fields"):o('input[name="'+i+'"]').closest("p").appendTo("#qliro-one-extra-checkout-fields")))}},updateAddress:(i=e().m(function n(i){var r,l,a,s,d,c,u,p,m,h,g,f,v,_,y,b,O,k,S,C,w,A,q,P,T,F,N,j,x,E,M,Q,J,G,D,I,L,R,W,z,V,X,U,$,B,H,K,Y,Z,ee,oe,ne,ie,re,te,le,ae,se,de,ce;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return o("#ship-to-different-address-checkbox").prop("checked",!0),o(".woocommerce-shipping-fields .shipping_address").show(),e.p=1,e.n=2,o.ajax({type:"POST",data:{nonce:qliroOneParams.get_order_nonce},dataType:"json",url:qliroOneParams.get_order_url});case 2:if(($=e.v).success){e.n=3;break}throw"Failed to GET address";case 3:B=$.data,V=B.billingAddress,X=B.shippingAddress,U=B.customer,e.n=5;break;case 4:e.p=4,ce=e.v,console.warning(ce),window.location.reload();case 5:H=null!==(r=null===(l=V)||void 0===l?void 0:l.FirstName)&&void 0!==r?r:null==i||null===(a=i.address)||void 0===a?void 0:a.firstName,K=null!==(s=null===(d=V)||void 0===d?void 0:d.LastName)&&void 0!==s?s:null==i||null===(c=i.address)||void 0===c?void 0:c.lastName,Y=null!==(u=null===(p=V)||void 0===p?void 0:p.Street)&&void 0!==u?u:null==i||null===(m=i.address)||void 0===m?void 0:m.street,Z=null!==(h=null===(g=V)||void 0===g?void 0:g.PostalCode)&&void 0!==h?h:null==i||null===(f=i.address)||void 0===f?void 0:f.postalCode,ee=null!==(v=null===(_=V)||void 0===_?void 0:_.City)&&void 0!==v?v:null==i||null===(y=i.address)||void 0===y?void 0:y.city,oe=null!==(b=null===(O=V)||void 0===O?void 0:O.Area)&&void 0!==b?b:null==i||null===(k=i.address)||void 0===k?void 0:k.area,ne=null!==(S=null===(C=U)||void 0===C?void 0:C.MobileNumber)&&void 0!==S?S:null==i?void 0:i.mobileNumber,ie=null!==(w=null===(A=U)||void 0===A?void 0:A.Email)&&void 0!==w?w:null==i?void 0:i.email,t.setCustomerType(i),null!=ie&&o("#billing_email").val(ie),null!=ne&&o("#billing_phone").val(ne),null!=H&&o("#billing_first_name").val(H),null!=K&&o("#billing_last_name").val(K),null!=Y&&o("#billing_address_1").val(Y),null!=Z&&o("#billing_postcode").val(Z),null!=ee&&o("#billing_city").val(ee),null!=oe&&t.setStateField("billing",oe),o("#billing_email").change(),o("#billing_email").blur(),re=null!==(q=null===(P=X)||void 0===P?void 0:P.FirstName)&&void 0!==q?q:null==i||null===(T=i.address)||void 0===T?void 0:T.firstName,te=null!==(F=null===(N=X)||void 0===N?void 0:N.LastName)&&void 0!==F?F:null==i||null===(j=i.address)||void 0===j?void 0:j.lastName,le=null!==(x=null===(E=X)||void 0===E?void 0:E.Street)&&void 0!==x?x:null==i||null===(M=i.address)||void 0===M?void 0:M.street,ae=null!==(Q=null===(J=X)||void 0===J?void 0:J.PostalCode)&&void 0!==Q?Q:null==i||null===(G=i.address)||void 0===G?void 0:G.postalCode,se=null!==(D=null===(I=X)||void 0===I?void 0:I.City)&&void 0!==D?D:null==i||null===(L=i.address)||void 0===L?void 0:L.city,de=null!==(R=null===(W=X)||void 0===W?void 0:W.Area)&&void 0!==R?R:null==i||null===(z=i.address)||void 0===z?void 0:z.area,null!=ie&&o("#shipping_email").val(ie),null!=ne&&o("#shipping_phone").val(ne),null!=re&&o("#shipping_first_name").val(re),null!=te&&o("#shipping_last_name").val(te),null!=le&&o("#shipping_address_1").val(le),null!=ae&&o("#shipping_postcode").val(ae),null!=se&&o("#shipping_city").val(se),null!=de&&t.setStateField("shipping",de),o("body").trigger("qliro_customer_data_fetched",[{customer:U,billingAddress:V,shippingAddress:X}]),o("body").trigger("update_checkout"),o("#shipping_email").change(),o("#shipping_email").blur();case 6:return e.a(2)}},n,null,[[1,4]])}),r=function(){var e=this,o=arguments;return new Promise(function(r,t){var l=i.apply(e,o);function a(e){n(l,r,t,a,s,"next",e)}function s(e){n(l,r,t,a,s,"throw",e)}a(void 0)})},function(e){return r.apply(this,arguments)}),setCustomerType:function(e){e.organizationNumber?Cookies.set(qliroOneParams.customerTypeCookieName,"business"):Cookies.set(qliroOneParams.customerTypeCookieName,"consumer")},getQliroOneOrder:function(e,n){t.logToFile("onValidateOrder from Qliro triggered"),o.ajax({type:"POST",data:{nonce:qliroOneParams.get_order_nonce},dataType:"json",url:qliroOneParams.get_order_url,success:function(e){},error:function(e){},complete:function(e){if(!0!==e.responseJSON.success)return t.failOrder("getQliroOneOrder",e.responseJSON.data,n),void(e.responseJSON.data.redirect&&(window.location.href=e.responseJSON.data.redirect));t.setAddressData(e.responseJSON.data,n),console.log("getQliroOneOrder completed")}})},setAddressData:function(e,n){o("#ship-to-different-address-checkbox").prop("checked",!0),o(".woocommerce-shipping-fields .shipping_address").show(),0<o("form.checkout #terms").length&&o("form.checkout #terms").prop("checked",!0),console.log(e),o("#billing_first_name").val(e.billingAddress.FirstName),o("#billing_last_name").val(e.billingAddress.LastName),o("#billing_company").val(e.billingAddress.CompanyName),o("#billing_address_1").val(e.billingAddress.Street),o("#billing_address_2").val(e.billingAddress.CareOf?e.billingAddress.CareOf+(e.billingAddress.Street2?" "+e.billingAddress.Street2:""):e.billingAddress.Street2),o("#billing_city").val(e.billingAddress.City),o("#billing_postcode").val(e.billingAddress.PostalCode),t.setStateField("billing",e.billingAddress.Area),o("#billing_phone").val(e.customer.MobileNumber),o("#billing_email").val(e.customer.Email),o("#shipping_first_name").val(e.shippingAddress.FirstName),o("#shipping_last_name").val(e.shippingAddress.LastName),o("#shipping_company").val(e.shippingAddress.CompanyName),o("#shipping_address_1").val(e.shippingAddress.Street),o("#shipping_address_2").val(e.shippingAddress.CareOf?e.shippingAddress.CareOf+(e.shippingAddress.Street2?" "+e.shippingAddress.Street2:""):e.shippingAddress.Street2),o("#shipping_city").val(e.shippingAddress.City),o("#shipping_postcode").val(e.shippingAddress.PostalCode),t.setStateField("shipping",e.shippingAddress.Area),e.billingAddress&&o("#billing_country").val(e.billingAddress.CountryCode),e.shippingAddress&&o("#shipping_country").val(e.shippingAddress.CountryCode),t.submitOrder(n)},setStateField:function(e,n){if(null!=n){var i=o("#".concat(e,"_state"));0!==i.length&&(i.is("select")?i.find("option").each(function(){o(this).text()===n&&i.val(o(this).val())}):i.val(n))}},submitOrder:function(e){o(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.ajax({type:"POST",url:qliroOneParams.submitOrder,data:o("form.checkout").serialize()+"&"+o("#billing_country").serialize(),dataType:"json",success:function(o){console.log(o);try{if("success"!==o.result)throw console.log("submit order - missing success",o),"Result failed";console.log("submit order success",o),t.logToFile('Successfully placed order. Sending "shouldProceed: true" to Qliro.'),e({shouldProceed:!0,errorMessage:""}),clearTimeout(t.timeout)}catch(i){if(console.log("catch error"),console.error(i),o.messages){var n=o.messages.replace(/<\/?[^>]+(>|$)/g,"");console.log("error ",n),t.logToFile("Checkout error | "+n),t.failOrder("submission",n,e)}else t.logToFile("Checkout error | No message"),t.failOrder("submission","Checkout error",e)}},error:function(o){try{t.logToFile("AJAX error | "+JSON.stringify(o))}catch(e){t.logToFile("AJAX error | Failed to parse error message.")}t.failOrder("ajax-error","Internal Server Error",e)}})},failOrder:function(e,n,i){clearTimeout(t.timeout),i({shouldProceed:!1,errorMessage:n}),o(t.checkoutFormSelector).removeClass("processing"),o(t.checkoutFormSelector).unblock(),o(".woocommerce-checkout-review-order-table").unblock(),o("body").trigger("update_checkout")},placeWooOrder:function(e,o){t.timeout=setTimeout(function(){t.logToFile("Timeout error | Timeout when placing the WooCommerce order"),t.failOrder("timeout-error","Timeout error",o)},29e3),t.getQliroOneOrder(e,o)},logToFile:function(e){o.ajax({url:qliroOneParams.log_to_file_url,type:"POST",dataType:"json",data:{message:e,nonce:qliroOneParams.log_to_file_nonce}})}};t.init()})})();
//# sourceMappingURL=qliro-one-for-woocommerce.min.js.map