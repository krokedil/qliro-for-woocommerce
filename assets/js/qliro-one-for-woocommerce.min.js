/*! For license information please see qliro-one-for-woocommerce.min.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return r};var o,r={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,o){e[t]=o.value},l="function"==typeof Symbol?Symbol:{},s=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function u(e,t,o){return Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(o){u=function(e,t,o){return e[t]=o}}function p(e,t,o,r){var n=t&&t.prototype instanceof _?t:_,i=Object.create(n.prototype),l=new N(r||[]);return a(i,"_invoke",{value:q(e,o,l)}),i}function h(e,t,o){try{return{type:"normal",arg:e.call(t,o)}}catch(e){return{type:"throw",arg:e}}}r.wrap=p;var f="suspendedStart",m="suspendedYield",g="executing",v="completed",y={};function _(){}function b(){}function w(){}var O={};u(O,s,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(F([])));S&&S!==n&&i.call(S,s)&&(O=S);var C=w.prototype=_.prototype=Object.create(O);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function P(t,o){function r(n,a,l,s){var c=h(t[n],t,a);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==e(u)&&i.call(u,"__await")?o.resolve(u.__await).then((function(e){r("next",e,l,s)}),(function(e){r("throw",e,l,s)})):o.resolve(u).then((function(e){d.value=e,l(d)}),(function(e){return r("throw",e,l,s)}))}s(c.arg)}var n;a(this,"_invoke",{value:function(e,t){function i(){return new o((function(o,n){r(e,t,o,n)}))}return n=n?n.then(i,i):i()}})}function q(e,t,r){var n=f;return function(i,a){if(n===g)throw new Error("Generator is already running");if(n===v){if("throw"===i)throw a;return{value:o,done:!0}}for(r.method=i,r.arg=a;;){var l=r.delegate;if(l){var s=T(l,r);if(s){if(s===y)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=g;var c=h(e,t,r);if("normal"===c.type){if(n=r.done?v:m,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=v,r.method="throw",r.arg=c.arg)}}}function T(e,t){var r=t.method,n=e.iterator[r];if(n===o)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=o,T(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=h(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,y;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=o),t.delegate=null,y):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function F(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=o,e.done=!0,e};return a.next=a}}throw new TypeError(e(t)+" is not iterable")}return b.prototype=w,a(C,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,d,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,d,"GeneratorFunction")),e.prototype=Object.create(C),e},r.awrap=function(e){return{__await:e}},x(P.prototype),u(P.prototype,c,(function(){return this})),r.AsyncIterator=P,r.async=function(e,t,o,n,i){void 0===i&&(i=Promise);var a=new P(p(e,t,o,n),i);return r.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(C),u(C,d,"Generator"),u(C,s,(function(){return this})),u(C,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),o=[];for(var r in t)o.push(r);return o.reverse(),function e(){for(;o.length;){var r=o.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},r.values=F,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=o)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return l.type="throw",l.arg=e,t.next=r,n&&(t.method="next",t.arg=o),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],l=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.finallyLoc===e)return this.complete(o.completion,o.afterLoc),E(o),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc===e){var r=o.completion;if("throw"===r.type){var n=r.arg;E(o)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:F(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=o),y}},r}function o(e,t,o,r,n,i,a){try{var l=e[i](a),s=l.value}catch(e){return void o(e)}l.done?t(s):Promise.resolve(s).then(r,n)}jQuery((function(e){if("undefined"==typeof qliroOneParams||"yes"!==qliroOneParams.isEnabled)return!1;var r,n,i={bodyEl:e("body"),checkoutFormSelector:"form.checkout",preventPaymentMethodChange:!1,selectAnotherSelector:"#qliro-one-select-other",paymentMethodEl:e('input[name="payment_method"]'),init:function(){e(document).ready(i.documentReady),i.bodyEl.on("change",'input[name="payment_method"]',i.maybeChangeToQliroOne),i.bodyEl.on("click",i.selectAnotherSelector,i.changeFromQliroOne),i.bodyEl.on("updated_checkout",i.maybeDisplayShippingPrice),i.renderIframe()},documentReady:function(){0<e('input[name="payment_method"]').length?i.paymentMethod=e('input[name="payment_method"]').filter(":checked").val():i.paymentMethod="qliro_one",qliroOneParams.payForOrder||"qliro_one"!==i.paymentMethod||i.moveExtraCheckoutFields(),i.bodyEl.on("update_checkout",i.updateCheckout),i.bodyEl.on("updated_checkout",i.updatedCheckout)},renderIframe:function(){window.q1Ready=function(e){e.onCustomerInfoChanged(i.updateAddress),e.onValidateOrder(i.placeWooOrder),e.onShippingMethodChanged(i.shippingMethodChanged)},e("#qliro-one-iframe").append(qliroOneParams.iframeSnippet)},updateCheckout:function(){void 0!==window.q1&&window.q1.lock()},updatedCheckout:function(){void 0!==window.q1&&window.q1.onOrderUpdated((function(e){window.q1.unlock()}))},shippingMethodChanged:function(t){e("#qoc_shipping_data").val(JSON.stringify(t)),e("body").trigger("qoc_shipping_option_changed",[t]),e("body").trigger("update_checkout")},changeFromQliroOne:function(t){t.preventDefault(),e(i.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",data:{qliro_one:!1,nonce:qliroOneParams.change_payment_method_nonce},url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToQliroOne:function(){i.preventPaymentMethodChange||"qliro_one"===e(this).val()&&(e(".woocommerce-info").remove(),e(i.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",data:{qliro_one:!0,nonce:qliroOneParams.change_payment_method_nonce},dataType:"json",url:qliroOneParams.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},maybeDisplayShippingPrice:function(){if(!e(".qoc-shipping").length&&"qliro_one"===i.paymentMethod&&"no"!==qliroOneParams.shipping_in_iframe)if(e("#shipping_method input[type='radio']").length)e("#shipping_method input[type='radio']:checked").each((function(){var t=e(this).attr("id"),o=e("label[for='"+t+"']").text();e(".woocommerce-shipping-totals td").html(o),e(".woocommerce-shipping-totals td").addClass("qoc-shipping")}));else{var t=e("#shipping_method input[name='shipping_method[0]']").attr("id"),o=e("label[for='"+t+"']").text();e(".woocommerce-shipping-totals td").html(o),e(".woocommerce-shipping-totals td").addClass("qoc-shipping")}},checkIfQliroOneSelected:function(){return i.paymentMethodEl.length>0&&(i.paymentMethod=i.paymentMethodEl.filter(":checked").val(),"qliro_one"===i.paymentMethod)},moveExtraCheckoutFields:function(){e(".woocommerce-additional-fields").appendTo("#qliro-one-extra-checkout-fields");for(var t=e('form[name="checkout"] input, form[name="checkout"] select, textarea'),o=0;o<t.length;o++){var r=t[o].name;e("table.woocommerce-checkout-review-order-table").find(t[o]).length||-1===e.inArray(r,qliroOneParams.standardWooCheckoutFields)&&(0<e("p#"+r+"_field").length?e("p#"+r+"_field").appendTo("#qliro-one-extra-checkout-fields"):e('input[name="'+r+'"]').closest("p").appendTo("#qliro-one-extra-checkout-fields"))}},updateAddress:(r=t().mark((function o(r){var n,a,l,s,c,d,u,p,h,f,m,g,v,y,_,b,w,O,k,S,C,x,P,q,T,A,E,N,F,L,j,M,Q,J,G,I,D,R,W,z,V,X,Y,U,$,B,H,K,Z,ee,te,oe,re,ne,ie,ae,le,se,ce;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.ajax({type:"POST",data:{nonce:qliroOneParams.get_order_nonce},dataType:"json",url:qliroOneParams.get_order_url});case 3:if((A=t.sent).success){t.next=6;break}throw"Failed to GET address";case 6:E=A.data,P=E.billingAddress,q=E.shippingAddress,T=E.customer,t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.warning(t.t0),window.location.reload();case 16:N=null!==(n=null===(a=P)||void 0===a?void 0:a.FirstName)&&void 0!==n?n:null==r||null===(l=r.address)||void 0===l?void 0:l.firstName,F=null!==(s=null===(c=P)||void 0===c?void 0:c.LastName)&&void 0!==s?s:null==r||null===(d=r.address)||void 0===d?void 0:d.lastName,L=null!==(u=null===(p=P)||void 0===p?void 0:p.Street)&&void 0!==u?u:null==r||null===(h=r.address)||void 0===h?void 0:h.street,j=null!==(f=null===(m=P)||void 0===m?void 0:m.PostalCode)&&void 0!==f?f:null==r||null===(g=r.address)||void 0===g?void 0:g.postalCode,M=null!==(v=null===(y=P)||void 0===y?void 0:y.City)&&void 0!==v?v:null==r||null===(_=r.address)||void 0===_?void 0:_.city,Q=null!==(b=null===(w=P)||void 0===w?void 0:w.Area)&&void 0!==b?b:null==r||null===(O=r.address)||void 0===O?void 0:O.area,J=null!==(k=null===(S=T)||void 0===S?void 0:S.MobileNumber)&&void 0!==k?k:null==r?void 0:r.mobileNumber,G=null!==(C=null===(x=T)||void 0===x?void 0:x.Email)&&void 0!==C?C:null==r?void 0:r.email,i.setCustomerType(r),e("#ship-to-different-address-checkbox").is(":checked")?(ne=null!==(I=null===(D=q)||void 0===D?void 0:D.FirstName)&&void 0!==I?I:null==r||null===(R=r.address)||void 0===R?void 0:R.firstName,ie=null!==(W=null===(z=q)||void 0===z?void 0:z.LastName)&&void 0!==W?W:null==r||null===(V=r.address)||void 0===V?void 0:V.lastName,ae=null!==(X=null===(Y=q)||void 0===Y?void 0:Y.Street)&&void 0!==X?X:null==r||null===(U=r.address)||void 0===U?void 0:U.street,le=null!==($=null===(B=q)||void 0===B?void 0:B.PostalCode)&&void 0!==$?$:null==r||null===(H=r.address)||void 0===H?void 0:H.postalCode,se=null!==(K=null===(Z=q)||void 0===Z?void 0:Z.City)&&void 0!==K?K:null==r||null===(ee=r.address)||void 0===ee?void 0:ee.city,ce=null!==(te=null===(oe=q)||void 0===oe?void 0:oe.Area)&&void 0!==te?te:null==r||null===(re=r.address)||void 0===re?void 0:re.area,null!=G&&e("#shipping_email").val(G),null!=J&&e("#shipping_phone").val(J),null!=ne&&e("#shipping_first_name").val(ne),null!=ie&&e("#shipping_last_name").val(ie),null!=ae&&e("#shipping_address_1").val(ae),null!=le&&e("#shipping_postcode").val(le),null!=se&&e("#shipping_city").val(se),null!=ce&&i.setStateField("shipping",ce),e("body").trigger("update_checkout"),e("#shipping_email").change(),e("#shipping_email").blur()):(null!=G&&e("#billing_email").val(G),null!=J&&e("#billing_phone").val(J),null!=N&&e("#billing_first_name").val(N),null!=F&&e("#billing_last_name").val(F),null!=L&&e("#billing_address_1").val(L),null!=j&&e("#billing_postcode").val(j),null!=M&&e("#billing_city").val(M),null!=Q&&i.setStateField("billing",Q),e("form.checkout").trigger("update_checkout"),e("#billing_email").change(),e("#billing_email").blur());case 26:case"end":return t.stop()}}),o,null,[[0,12]])})),n=function(){var e=this,t=arguments;return new Promise((function(n,i){var a=r.apply(e,t);function l(e){o(a,n,i,l,s,"next",e)}function s(e){o(a,n,i,l,s,"throw",e)}l(void 0)}))},function(e){return n.apply(this,arguments)}),setCustomerType:function(e){e.organizationNumber?Cookies.set(qliroOneParams.customerTypeCookieName,"business"):Cookies.set(qliroOneParams.customerTypeCookieName,"consumer")},getQliroOneOrder:function(t,o){i.logToFile("onValidateOrder from Qliro triggered"),e.ajax({type:"POST",data:{nonce:qliroOneParams.get_order_nonce},dataType:"json",url:qliroOneParams.get_order_url,success:function(e){},error:function(e){},complete:function(e){if(!0!==e.responseJSON.success)return i.failOrder("getQliroOneOrder",e.responseJSON.data,o),void(e.responseJSON.data.redirect&&(window.location.href=e.responseJSON.data.redirect));i.setAddressData(e.responseJSON.data,o),console.log("getQliroOneOrder completed")}})},setAddressData:function(t,o){0<e("form.checkout #terms").length&&e("form.checkout #terms").prop("checked",!0),console.log(t),e("#billing_first_name").val(t.billingAddress.FirstName),e("#billing_last_name").val(t.billingAddress.LastName),e("#billing_company").val(t.billingAddress.CompanyName),e("#billing_address_1").val(t.billingAddress.Street),e("#billing_address_2").val(t.billingAddress.Street2),e("#billing_city").val(t.billingAddress.City),e("#billing_postcode").val(t.billingAddress.PostalCode),i.setStateField("billing",t.billingAddress.Area),e("#billing_phone").val(t.customer.MobileNumber),e("#billing_email").val(t.customer.Email),e("#ship-to-different-address-checkbox").prop("checked",!0),e("#shipping_first_name").val(t.shippingAddress.FirstName),e("#shipping_last_name").val(t.shippingAddress.LastName),e("#shipping_company").val(t.shippingAddress.CompanyName),e("#shipping_address_1").val(t.shippingAddress.Street),e("#shipping_address_2").val(t.shippingAddress.Street2),e("#shipping_city").val(t.shippingAddress.City),e("#shipping_postcode").val(t.shippingAddress.PostalCode),i.setStateField("shipping",t.shippingAddress.Area),t.billingAddress&&e("#billing_country").val(t.billingAddress.CountryCode),t.shippingAddress&&e("#shipping_country").val(t.shippingAddress.CountryCode),i.submitOrder(o)},setStateField:function(t,o){if(null!=o){var r=e("#".concat(t,"_state"));0!==r.length&&(r.is("select")?r.find("option").each((function(){e(this).text()===o&&r.val(e(this).val())})):r.val(o))}},submitOrder:function(t){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:qliroOneParams.submitOrder,data:e("form.checkout").serialize(),dataType:"json",success:function(e){console.log(e);try{if("success"!==e.result)throw console.log("submit order - missing success",e),"Result failed";console.log("submit order success",e),i.logToFile('Successfully placed order. Sending "shouldProceed: true" to Qliro.'),t({shouldProceed:!0,errorMessage:""}),clearTimeout(i.timeout)}catch(r){if(console.log("catch error"),console.error(r),e.messages){var o=e.messages.replace(/<\/?[^>]+(>|$)/g,"");console.log("error ",o),i.logToFile("Checkout error | "+o),i.failOrder("submission",o,t)}else i.logToFile("Checkout error | No message"),i.failOrder("submission","Checkout error",t)}},error:function(e){try{i.logToFile("AJAX error | "+JSON.stringify(e))}catch(e){i.logToFile("AJAX error | Failed to parse error message.")}i.failOrder("ajax-error","Internal Server Error",t)}})},failOrder:function(t,o,r){clearTimeout(i.timeout),r({shouldProceed:!1,errorMessage:o}),e("body").trigger("updated_checkout"),e(i.checkoutFormSelector).removeClass("processing"),e(i.checkoutFormSelector).unblock(),e(".woocommerce-checkout-review-order-table").unblock()},placeWooOrder:function(e,t){i.timeout=setTimeout((function(){i.logToFile("Timeout error | Timeout when placing the WooCommerce order"),i.failOrder("timeout-error","Timeout error",t)}),29e3),i.getQliroOneOrder(e,t)},logToFile:function(t){e.ajax({url:qliroOneParams.log_to_file_url,type:"POST",dataType:"json",data:{message:t,nonce:qliroOneParams.log_to_file_nonce}})}};i.init()}))})();
//# sourceMappingURL=qliro-one-for-woocommerce.min.js.map