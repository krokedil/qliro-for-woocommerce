{"version":3,"file":"qliro-one-for-woocommerce.min.js","mappings":"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","sources":["webpack://qliro-one-for-woocommerce/./assets/js/qliro-one-for-woocommerce.js"],"sourcesContent":["/**\r\n * @var qliroOneParams\r\n */\r\njQuery( function( $ ) {\r\n\tif ( typeof qliroOneParams === 'undefined' || qliroOneParams.isEnabled !== 'yes' ) {\r\n\t\treturn false;\r\n\t}\r\n\tvar qliroOneForWooCommerce = {\r\n\t\tbodyEl: $('body'),\r\n\t\tcheckoutFormSelector: 'form.checkout',\r\n\t\tpreventPaymentMethodChange: false,\r\n\t\tselectAnotherSelector: '#qliro-one-select-other',\r\n\t\tpaymentMethodEl: $('input[name=\"payment_method\"]'),\r\n\r\n\t\tinit: function () {\r\n\t\t\t$( document ).ready( qliroOneForWooCommerce.documentReady );\r\n\t\t\tqliroOneForWooCommerce.bodyEl.on( 'change', 'input[name=\"payment_method\"]', qliroOneForWooCommerce.maybeChangeToQliroOne );\r\n\t\t\tqliroOneForWooCommerce.bodyEl.on( 'click', qliroOneForWooCommerce.selectAnotherSelector, qliroOneForWooCommerce.changeFromQliroOne );\r\n\t\t\tqliroOneForWooCommerce.bodyEl.on( 'updated_checkout', qliroOneForWooCommerce.maybeDisplayShippingPrice );\r\n\t\t\tqliroOneForWooCommerce.renderIframe();\r\n\t\t},\r\n\t\t/**\r\n\t\t * Triggers on document ready.\r\n\t\t */\r\n\t\tdocumentReady: function() {\r\n\t\t\tif ( 0 < $('input[name=\"payment_method\"]').length ) {\r\n\t\t\t\tqliroOneForWooCommerce.paymentMethod = $('input[name=\"payment_method\"]').filter( ':checked' ).val();\r\n\t\t\t} else {\r\n\t\t\t\tqliroOneForWooCommerce.paymentMethod = 'qliro_one';\r\n\t\t\t}\r\n\r\n\t\t\tif( ! qliroOneParams.payForOrder && qliroOneForWooCommerce.paymentMethod === 'qliro_one' ) {\r\n\t\t\t\tqliroOneForWooCommerce.moveExtraCheckoutFields();\r\n\t\t\t}\r\n\t\t\tqliroOneForWooCommerce.bodyEl.on('update_checkout', qliroOneForWooCommerce.updateCheckout);\r\n\t\t\tqliroOneForWooCommerce.bodyEl.on('updated_checkout', qliroOneForWooCommerce.updatedCheckout);\r\n\t\t},\r\n\t\trenderIframe: function() {\r\n\t\t\twindow.q1Ready = function(q1) {\r\n\t\t\t\tq1.onCustomerInfoChanged(qliroOneForWooCommerce.updateAddress);\r\n\t\t\t\tq1.onValidateOrder(qliroOneForWooCommerce.placeWooOrder);\r\n\t\t\t\tq1.onShippingMethodChanged(qliroOneForWooCommerce.shippingMethodChanged);\r\n\t\t\t}\r\n\t\t\t$('#qliro-one-iframe').append( qliroOneParams.iframeSnippet );\r\n\t\t},\r\n\t\tupdateCheckout: function() {\r\n\t\t\tif (window.q1 !== undefined) {\r\n\t\t\t\twindow.q1.lock();\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdatedCheckout: function() {\r\n\t\t\tif (window.q1 !== undefined) {\r\n\t\t\t\twindow.q1.onOrderUpdated(function (order) {\r\n\t\t\t\t\twindow.q1.unlock();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tshippingMethodChanged: function (shipping) {\r\n\t\t\t$('#qoc_shipping_data').val(JSON.stringify(shipping));\r\n\t\t\t$( 'body' ).trigger( 'qoc_shipping_option_changed', [ shipping ]);\r\n\t\t\t$( 'body' ).trigger( 'update_checkout' );\r\n\t\t},\r\n\t\t/**\r\n\t\t * When the customer changes from Qliro One to other payment methods.\r\n\t\t * @param {Event} e\r\n\t\t */\r\n\t\tchangeFromQliroOne: function( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\t$( qliroOneForWooCommerce.checkoutFormSelector ).block({\r\n\t\t\t\tmessage: null,\r\n\t\t\t\toverlayCSS: {\r\n\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\topacity: 0.6\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tqliro_one: false,\r\n\t\t\t\t\tnonce: qliroOneParams.change_payment_method_nonce\r\n\t\t\t\t},\r\n\t\t\t\turl: qliroOneParams.change_payment_method_url,\r\n\t\t\t\tsuccess: function( data ) {},\r\n\t\t\t\terror: function( data ) {},\r\n\t\t\t\tcomplete: function( data ) {\r\n\t\t\t\t\twindow.location.href = data.responseJSON.data.redirect;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * When the customer changes to Qliro One from other payment methods.\r\n\t\t */\r\n\t\tmaybeChangeToQliroOne: function() {\r\n\t\t\tif ( ! qliroOneForWooCommerce.preventPaymentMethodChange ) {\r\n\t\t\t\tif ( 'qliro_one' === $( this ).val() ) {\r\n\t\t\t\t\t$( '.woocommerce-info' ).remove();\r\n\t\t\t\t\t$( qliroOneForWooCommerce.checkoutFormSelector ).block({\r\n\t\t\t\t\t\tmessage: null,\r\n\t\t\t\t\t\toverlayCSS: {\r\n\t\t\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\t\t\topacity: 0.6\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tqliro_one: true,\r\n\t\t\t\t\t\t\tnonce: qliroOneParams.change_payment_method_nonce\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\turl: qliroOneParams.change_payment_method_url,\r\n\t\t\t\t\t\tsuccess: function( data ) {},\r\n\t\t\t\t\t\terror: function( data ) {},\r\n\t\t\t\t\t\tcomplete: function( data ) {\r\n\t\t\t\t\t\t\twindow.location.href = data.responseJSON.data.redirect;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Display Shipping Price in order review if Display shipping methods in iframe settings is active.\r\n\t\t */\r\n\t\tmaybeDisplayShippingPrice: function() {\r\n\t\t// Check if we already have set the price. If we have, return.\r\n\t\tif( $('.qoc-shipping').length ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif ( 'qliro_one' === qliroOneForWooCommerce.paymentMethod && 'yes' === qliroOneParams.shipping_in_iframe ) {\r\n\t\t\tif ( $( '#shipping_method input[type=\\'radio\\']' ).length ) {\r\n\t\t\t\t// Multiple shipping options available.\r\n\t\t\t\t$( '#shipping_method input[type=\\'radio\\']:checked' ).each( function() {\r\n\t\t\t\t\tvar idVal = $( this ).attr( 'id' );\r\n\t\t\t\t\tvar shippingPrice = $( 'label[for=\\'' + idVal + '\\']' ).text();\r\n\t\t\t\t\t$( '.woocommerce-shipping-totals td' ).html( shippingPrice );\r\n\t\t\t\t\t$( '.woocommerce-shipping-totals td' ).addClass( 'qoc-shipping' );\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Only one shipping option available.\r\n\t\t\t\tvar idVal = $( '#shipping_method input[name=\\'shipping_method[0]\\']' ).attr( 'id' );\r\n\t\t\t\tvar shippingPrice = $( 'label[for=\\'' + idVal + '\\']' ).text();\r\n\t\t\t\t$( '.woocommerce-shipping-totals td' ).html( shippingPrice );\r\n\t\t\t\t$( '.woocommerce-shipping-totals td' ).addClass( 'qoc-shipping' );\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\t/*\r\n\t\t * Check if Qliro One is the selected gateway.\r\n\t\t */\r\n\t\tcheckIfQliroOneSelected: function() {\r\n\t\t\tif (qliroOneForWooCommerce.paymentMethodEl.length > 0) {\r\n\t\t\t\tqliroOneForWooCommerce.paymentMethod = qliroOneForWooCommerce.paymentMethodEl.filter(':checked').val();\r\n\t\t\t\tif( 'qliro_one' === qliroOneForWooCommerce.paymentMethod ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Moves all non standard fields to the extra checkout fields.\r\n\t\t */\r\n\t\tmoveExtraCheckoutFields: function() {\r\n\t\t\t// Move order comments.\r\n\t\t\t$('.woocommerce-additional-fields').appendTo('#qliro-one-extra-checkout-fields');\r\n\r\n\t\t\tlet form = $('form[name=\"checkout\"] input, form[name=\"checkout\"] select, textarea');\r\n\t\t\tfor (var i = 0; i < form.length; i++ ) {\r\n\t\t\t\tlet name = form[i].name;\r\n\t\t\t\t// Check if field is inside the order review.\r\n\t\t\t\tif( $( 'table.woocommerce-checkout-review-order-table' ).find( form[i] ).length ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if this is a standard field.\r\n\t\t\t\tif ( -1 === $.inArray( name, qliroOneParams.standardWooCheckoutFields ) ) {\r\n\t\t\t\t\t// This is not a standard Woo field, move to our div.\r\n\t\t\t\t\tif ( 0 < $( 'p#' + name + '_field' ).length ) {\r\n\t\t\t\t\t\t$( 'p#' + name + '_field' ).appendTo( '#qliro-one-extra-checkout-fields' );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$( 'input[name=\"' + name + '\"]' ).closest( 'p' ).appendTo( '#qliro-one-extra-checkout-fields' );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateAddress: function (customerInfo) {\r\n\t\t\tvar email = (('email' in customerInfo) ? customerInfo.email : null);\r\n\t\t\tvar phone = (('mobileNumber' in customerInfo) ? customerInfo.mobileNumber : null);\r\n\r\n\t\t\tvar firstName, lastName, street, postalCode, city;\r\n\t\t\tif (customerInfo.address) {\r\n\t\t\t\tfirstName = (('firstName' in customerInfo.address) ? customerInfo.address.firstName : null);\r\n\t\t\t\tlastName = (('lastName' in customerInfo.address) ? customerInfo.address.lastName : null);\r\n\t\t\t\tstreet = (('street' in customerInfo.address) ? street : null);\r\n\t\t\t\tpostalCode = (('postalCode' in customerInfo.address) ? customerInfo.address.postalCode : null);\r\n\t\t\t\tcity = (('city' in customerInfo.address) ? customerInfo.address.city : null);\r\n\t\t\t}\r\n\r\n\t\t\t// Check if shipping fields or billing fields are to be used.\r\n\t\t\tif (!$('#ship-to-different-address-checkbox').is(\":checked\")) {\r\n\t\t\t\t(email !== null && email !== undefined) ? $('#billing_email').val(email) : null;\r\n\t\t\t\t(phone !== null && phone !== undefined) ? $('#billing_phone').val(phone) : null;\r\n\t\t\t\t(firstName !== null && firstName !== undefined) ? $('#billing_first_name').val(firstName) : null;\r\n\t\t\t\t(lastName !== null && lastName !== undefined) ? $('#billing_last_name').val(lastName) : null;\r\n\t\t\t\t(street !== null && street !== undefined) ? $('#billing_address_1').val(street) : null;\r\n\t\t\t\t(postalCode !== null && postalCode !== undefined) ? $('#billing_postcode').val(postalCode) : null;\r\n\t\t\t\t(city !== null && city !== undefined) ? $('#billing_city').val(city) : null;\r\n\t\t\t\t$(\"form.checkout\").trigger('update_checkout');\r\n\t\t\t\t$('#billing_email').change();\r\n\t\t\t\t$('#billing_email').blur();\r\n\t\t\t} else {\r\n\t\t\t\t(email !== null && email !== undefined) ? $('#shipping_email').val(email) : null;\r\n\t\t\t\t(phone !== null && phone !== undefined) ? $('#shipping_phone').val(phone) : null;\r\n\t\t\t\t(firstName !== null && firstName !== undefined) ? $('#shipping_first_name').val(firstName) : null;\r\n\t\t\t\t(lastName !== null && lastName !== undefined) ? $('#shipping_last_name').val(lastName) : null;\r\n\t\t\t\t(street !== null && street !== undefined) ? $('#shipping_address_1').val(street) : null;\r\n\t\t\t\t(postalCode !== null && postalCode !== undefined) ? $('#shipping_postcode').val(postalCode) : null;\r\n\t\t\t\t(city !== null && city !== undefined) ? $('#shipping_city').val(city) : null;\r\n\t\t\t\t$(\"form.checkout\").trigger('update_checkout');\r\n\t\t\t\t$('#shipping_email').change();\r\n\t\t\t\t$('#shipping_email').blur();\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetQliroOneOrder: function (data, callback) {\r\n\t\t\tqliroOneForWooCommerce.logToFile( 'onValidateOrder from Qliro triggered' );\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tnonce: qliroOneParams.get_order_nonce,\r\n\t\t\t\t},\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\turl: qliroOneParams.get_order_url,\r\n\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t},\r\n\t\t\t\terror: function (data) {\r\n\t\t\t\t},\r\n\t\t\t\tcomplete: function (data) {\r\n\t\t\t\t\tqliroOneForWooCommerce.setAddressData(data.responseJSON.data, callback);\r\n\t\t\t\t\tconsole.log('getQliroOneOrder completed');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t/*\r\n\t\t * Sets the WooCommerce form field data.\r\n\t\t */\r\n\t\tsetAddressData: function (addressData, callback) {\r\n\t\t\tif (0 < $('form.checkout #terms').length) {\r\n\t\t\t\t$('form.checkout #terms').prop('checked', true);\r\n\t\t\t}\r\n\t\t\tconsole.log( addressData );\r\n\r\n\t\t\t// Billing fields.\r\n\t\t\t$('#billing_first_name').val(addressData.billingAddress.FirstName);\r\n\t\t\t$('#billing_last_name').val(addressData.billingAddress.LastName);\r\n\t\t\t$('#billing_company').val(addressData.billingAddress.CompanyName);\r\n\t\t\t$('#billing_address_1').val(addressData.billingAddress.Street);\r\n\t\t\t$('#billing_address_2').val(addressData.billingAddress.Street2);\r\n\t\t\t$('#billing_city').val(addressData.billingAddress.City);\r\n\t\t\t$('#billing_postcode').val(addressData.billingAddress.PostalCode);\r\n\t\t\t$('#billing_phone').val(addressData.customer.MobileNumber);\r\n\t\t\t$('#billing_email').val(addressData.customer.Email);\r\n\r\n\t\t\t// Shipping fields.\r\n\t\t\t$('#ship-to-different-address-checkbox').prop( 'checked', true);\r\n\t\t\t$('#shipping_first_name').val(addressData.shippingAddress.FirstName);\r\n\t\t\t$('#shipping_last_name').val(addressData.shippingAddress.LastName);\r\n\t\t\t$('#shipping_company').val(addressData.shippingAddress.CompanyName);\r\n\t\t\t$('#shipping_address_1').val(addressData.shippingAddress.Street);\r\n\t\t\t$('#shipping_address_2').val(addressData.shippingAddress.Street2);\r\n\t\t\t$('#shipping_city').val(addressData.shippingAddress.City);\r\n\t\t\t$('#shipping_postcode').val(addressData.shippingAddress.PostalCode);\r\n\t\t\t// todo country\r\n\r\n\t\t\t// Only set country fields if we have data in them.\r\n\t\t\tif (addressData.billingAddress) {\r\n\t\t\t\t$('#billing_country').val(addressData.billingAddress.CountryCode);\r\n\t\t\t}\r\n\t\t\tif (addressData.shippingAddress) {\r\n\t\t\t\t$('#shipping_country').val(addressData.shippingAddress.CountryCode);\r\n\t\t\t}\r\n\r\n\t\t\tqliroOneForWooCommerce.submitOrder(callback);\r\n\r\n\t\t},\r\n\t\t/**\r\n\t\t * Submit the order using the WooCommerce AJAX function.\r\n\t\t */\r\n\t\tsubmitOrder: function (callback) {\r\n\t\t\t$('.woocommerce-checkout-review-order-table').block({\r\n\t\t\t\tmessage: null,\r\n\t\t\t\toverlayCSS: {\r\n\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\topacity: 0.6\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\turl: qliroOneParams.submitOrder,\r\n\t\t\t\tdata: $('form.checkout').serialize(),\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\tconsole.log(data);\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif ('success' === data.result) {\r\n\t\t\t\t\t\t\tconsole.log('submit order success', data);\r\n\t\t\t\t\t\t\tqliroOneForWooCommerce.logToFile( 'Successfully placed order. Sending \"shouldProceed: true\" to Qliro.' );\r\n\t\t\t\t\t\t\tcallback({shouldProceed: true, errorMessage: \"\"});\r\n\r\n\t\t\t\t\t\t\t// Remove the timeout.\r\n\t\t\t\t\t\t\tclearTimeout( qliroOneForWooCommerce.timeout );\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log('submit order - missing success', data);\r\n\t\t\t\t\t\t\tthrow 'Result failed';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tconsole.log('catch error');\r\n\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\tif (data.messages) {\r\n\t\t\t\t\t\t\t// Strip HTML code from messages.\r\n\t\t\t\t\t\t\tlet messages = data.messages.replace(/<\\/?[^>]+(>|$)/g, \"\");\r\n\t\t\t\t\t\t\tconsole.log('error ', messages);\r\n\t\t\t\t\t\t\tqliroOneForWooCommerce.logToFile( 'Checkout error | ' + messages );\r\n\t\t\t\t\t\t\tqliroOneForWooCommerce.failOrder( 'submission', messages, callback );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tqliroOneForWooCommerce.logToFile( 'Checkout error | No message' );\r\n\t\t\t\t\t\t\tqliroOneForWooCommerce.failOrder( 'submission', 'Checkout error', callback );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (data) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tqliroOneForWooCommerce.logToFile( 'AJAX error | ' + JSON.stringify(data) );\r\n\t\t\t\t\t} catch( e ) {\r\n\t\t\t\t\t\tqliroOneForWooCommerce.logToFile( 'AJAX error | Failed to parse error message.' );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tqliroOneForWooCommerce.failOrder( 'ajax-error', 'Internal Server Error', callback )\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tfailOrder: function( event, error_message, callback ) {\r\n\r\n\t\t\t// Remove the timeout.\r\n\t\t\tclearTimeout( qliroOneForWooCommerce.timeout );\r\n\r\n\t\t\tcallback({shouldProceed: false, errorMessage: error_message});\r\n\r\n\t\t\t// Re-enable the form.\r\n\t\t\t$( 'body' ).trigger( 'updated_checkout' );\r\n\t\t\tvar className = 'form.checkout';\r\n\t\t\t$( qliroOneForWooCommerce.checkoutFormSelector ).removeClass( 'processing' );\r\n\t\t\t$( qliroOneForWooCommerce.checkoutFormSelector ).unblock();\r\n\t\t\t$( '.woocommerce-checkout-review-order-table' ).unblock();\r\n\t\t},\r\n\r\n\t\tplaceWooOrder: function( data, callback ) {\r\n\r\n\t\t\tqliroOneForWooCommerce.timeout = setTimeout( () => {\r\n\t\t\t\tqliroOneForWooCommerce.logToFile( 'Timeout error | Timeout when placing the WooCommerce order' );\r\n\t\t\t\tqliroOneForWooCommerce.failOrder( 'timeout-error', 'Timeout error', callback );\r\n\t\t\t}, 4500 );\r\n\r\n\t\t\tqliroOneForWooCommerce.getQliroOneOrder( data, callback );\r\n\r\n\t\t},\r\n\t\t/**\r\n\t\t * Logs the message to the klarna checkout log in WooCommerce.\r\n\t\t * @param {string} message\r\n\t\t */\r\n\t\tlogToFile: function( message ) {\r\n\t\t\t$.ajax(\r\n\t\t\t\t{\r\n\t\t\t\t\turl: qliroOneParams.log_to_file_url,\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tmessage: message,\r\n\t\t\t\t\t\tnonce: qliroOneParams.log_to_file_nonce\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\t};\r\n\tqliroOneForWooCommerce.init();\r\n});\r\n"],"names":["jQuery","$","qliroOneParams","isEnabled","qliroOneForWooCommerce","bodyEl","checkoutFormSelector","preventPaymentMethodChange","selectAnotherSelector","paymentMethodEl","init","document","ready","documentReady","on","maybeChangeToQliroOne","changeFromQliroOne","maybeDisplayShippingPrice","renderIframe","length","paymentMethod","filter","val","payForOrder","moveExtraCheckoutFields","updateCheckout","updatedCheckout","window","q1Ready","q1","onCustomerInfoChanged","updateAddress","onValidateOrder","placeWooOrder","onShippingMethodChanged","shippingMethodChanged","append","iframeSnippet","undefined","lock","onOrderUpdated","order","unlock","shipping","JSON","stringify","trigger","e","preventDefault","block","message","overlayCSS","background","opacity","ajax","type","dataType","data","qliro_one","nonce","change_payment_method_nonce","url","change_payment_method_url","success","error","complete","location","href","responseJSON","redirect","this","remove","shipping_in_iframe","each","idVal","attr","shippingPrice","text","html","addClass","checkIfQliroOneSelected","appendTo","form","i","name","find","inArray","standardWooCheckoutFields","closest","customerInfo","firstName","lastName","street","postalCode","city","email","phone","mobileNumber","address","is","change","blur","getQliroOneOrder","callback","logToFile","get_order_nonce","get_order_url","setAddressData","console","log","addressData","prop","billingAddress","FirstName","LastName","CompanyName","Street","Street2","City","PostalCode","customer","MobileNumber","Email","shippingAddress","CountryCode","submitOrder","serialize","result","shouldProceed","errorMessage","clearTimeout","timeout","err","messages","replace","failOrder","event","error_message","removeClass","unblock","setTimeout","log_to_file_url","log_to_file_nonce"],"sourceRoot":""}